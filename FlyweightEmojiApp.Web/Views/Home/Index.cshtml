@model FlyweightEmojiApp.Models.ReporteViewModel
@{
    ViewData["Title"] = "Demostración del Patrón Flyweight";
}

<style>
    .stat-card {
        border-left: 5px solid;
        transition: transform 0.2s ease-in-out;
    }

        .stat-card:hover {
            transform: translateY(-5px);
        }

    .border-primary {
        border-color: #0d6efd !important;
    }

    .border-success {
        border-color: #198754 !important;
    }

    .emoji-log-item {
        font-size: 2.5rem;
    }

    .flyweight-cache-item {
        font-size: 2rem;
        padding: 0.5rem 1rem;
        background-color: #e9ecef;
        border-radius: 0.5rem;
    }
</style>

<div class="text-center pt-4 pb-5">
    <h1 class="display-4 fw-bold">Patrón de Diseño Flyweight</h1>
    <p class="lead text-muted col-lg-8 mx-auto">
        Observa cómo reutilizar objetos compartidos puede reducir drásticamente el consumo de memoria. Cada emoji único se crea una sola vez, sin importar cuántas veces lo uses.
    </p>
</div>

<div class="row mb-5">
    <div class="col-md-6 mb-3">
        <div class="card stat-card border-primary shadow-sm h-100">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted text-uppercase">Total de Usos Registrados</h6>
                <p class="display-3 fw-bold text-primary">@Model.UsosDeEmojis.Count()</p>
                <i class="bi bi-list-ol fs-1 text-primary opacity-25"></i>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card stat-card border-success shadow-sm h-100">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted text-uppercase">Objetos Únicos en Memoria</h6>
                <p class="display-3 fw-bold text-success">@Model.TotalFlyweightsEnMemoria</p>
                <i class="bi bi-memory fs-1 text-success opacity-25"></i>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-5">
        <div class="card shadow-sm">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-plus-circle-fill me-2 fs-5"></i>
                <h5 class="mb-0">Agregar Nuevo Uso de Emoji</h5>
            </div>
            <div class="card-body p-4">
                <form asp-action="AgregarEmoji" method="post">
                    <div class="mb-3">
                        <label class="form-label">Ingresa un emoji:</label>
                        <input type="text" name="simbolo" class="form-control form-control-lg" placeholder="Ej: 😎, 👍, ❤️" maxlength="2" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contexto de uso:</label>
                        <input type="text" name="contexto" class="form-control" value="Mensaje" required />
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="form-label">Posición X:</label>
                            <input type="number" name="posicionX" class="form-control" value="@(new Random().Next(1, 100))" required />
                        </div>
                        <div class="col">
                            <label class="form-label">Posición Y:</label>
                            <input type="number" name="posicionY" class="form-control" value="@(new Random().Next(1, 100))" required />
                        </div>
                    </div>
                    <hr />
                    <button type="submit" class="btn btn-primary w-100 btn-lg">
                        <i class="bi bi-send-plus"></i> Agregar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-7">
        <div class="card shadow-sm mb-4">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-collection-fill me-2 fs-5"></i>
                <h5 class="mb-0">Flyweights en Memoria (Caché)</h5>
            </div>
            <div class="card-body d-flex flex-wrap justify-content-center gap-3">
                @if (!Model.FlyweightsCacheados.Any())
                {
                    <p class="text-muted m-0">El caché está vacío.</p>
                }
                @foreach (var simbolo in Model.FlyweightsCacheados)
                {
                    <span class="flyweight-cache-item" title="Objeto compartido: @simbolo">@simbolo</span>
                }
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header d-flex align-items-center">
                <i class="bi bi-card-list me-2 fs-5"></i>
                <h5 class="mb-0">Registro Detallado de Usos</h5>
            </div>
            <div class="list-group list-group-flush" style="max-height: 400px; overflow-y: auto;">
                @if (!Model.UsosDeEmojis.Any())
                {
                    <div class="list-group-item text-center text-muted p-4">
                        Aún no se ha registrado ningún uso.
                    </div>
                }
                @foreach (var uso in Model.UsosDeEmojis.Reverse())
                {
                    <div class="list-group-item d-flex align-items-center">
                        <span class="emoji-log-item me-3">@uso.Emoji.Simbolo</span>
                        <div class="flex-grow-1">
                            <span class="fw-bold">@uso.Contexto</span>
                            <br>
                            <small class="text-muted">Estado Extrínseco (único) &rarr; Posición: (@uso.PosicionX, @uso.PosicionY)</small>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>